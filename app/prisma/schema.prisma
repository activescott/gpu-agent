// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model gpu {
  // unique name for the card; also primary key
  name  String @id @unique
  label String

  // Specs:
  tensorCoreCount    Float
  fp32TFLOPS         Float
  fp16TFLOPS         Float
  int8TOPS           Float
  memoryCapacityGB   Float
  memoryBandwidthGBs Float

  // track when the listings were fetched and updated in Listings
  lastCachedListings DateTime?

  // references for the specs:
  references        String[]
  // custom-written summary for the GPU. Used on info pages
  summary           String @default("")

  // for the prisma relation for Listing.gpu/gpuName
  Listing   Listing[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Listing {
  itemId String  @id @unique
  // we use this as a soft-delete
  // ebay doesn't provide the sold status of an item - the items just don't come back from the search endpoints.
  // so we use this to mark items as stale and not return them.
  stale  Boolean @default(false)

  title                    String
  priceValue               String
  priceCurrency            String
  buyingOptions            String[] // e.g. | "FIXED_PRICE" | "AUCTION" | "BEST_OFFER" | "CLASSIFIED_AD"
  imageUrl                 String
  adultOnly                Boolean
  itemHref                 String
  leafCategoryIds          String[]
  listingMarketplaceId     String?
  sellerUsername           String
  sellerFeedbackPercentage String
  sellerFeedbackScore      Int
  condition                String?
  conditionId              String?
  itemAffiliateWebUrl      String
  // we flatten these from a list.
  thumbnailImageUrl        String
  epid                     String
  itemCreationDate         DateTime?
  itemLocationCountry      String?

  // relation per https://www.prisma.io/docs/concepts/components/prisma-schema/relations/one-to-many-relations
  // when gpu is deleted, so are its listings
  gpu     gpu    @relation(fields: [gpuName], references: [name], onDelete: NoAction, onUpdate: Cascade)
  gpuName String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}
